<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Button Logs Dashboard</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  table { width: 100%; border-collapse: collapse; margin-top: 20px; padding-bottom: 10px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  button { margin-bottom: 20px; padding: 10px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;padding-bottom: 10px; }
  th { background-color: #f4f4f4; }
</style>
</head>
<body>
<h1>Button Logs Dashboard</h1>
<button onclick="loadLogs()">Refresh Logs</button>
<table>
  <thead>
    <tr>
      <th>Checkpoint</th>
      <th>Action</th>
      <th>Decision</th>
      <th>Timestamp</th>
      <th>User Agent</th>
      <th>IP</th>
      <th>URL</th>
      <th>Extra Data</th>
    </tr>
  </thead>
  <tbody id="logsTable"></tbody>
</table>
<button onclick="clearLogs()">clear logs</button>
<script>

async function clearLogs() {
  if (!confirm('Are you sure you want to clear all logs?')) return;

  try {
    const res = await fetch('http://localhost:8000/api/button/clear', { method: 'DELETE' });
    if (res.ok) {
      alert('Logs cleared successfully');
      loadLogs();
    } else {
      alert('Failed to clear logs');
    }
  } catch (err) {
    console.error(err);
    alert('Error clearing logs');
  }
}
async function loadLogs() {
  const tbody = document.getElementById('logsTable');
  tbody.innerHTML = 'Loading...';
  
  try {
    const res = await fetch('http://localhost:8000/api/button/all');
    const logs = await res.json();

    tbody.innerHTML = logs.map(log => `
      <tr>
        <td>${log.checkpointId}</td>
        <td>${log.action}</td>
        <td>${log.decision || ''}</td>
        <td>${new Date(log.timestamp).toLocaleString()}</td>
        <td>${log.userAgent}</td>
        <td>${log.ip || ''}</td>
        <td>${log.url}</td>
        <td>${JSON.stringify(log.extraData)}</td>
      </tr>
    `).join('');
  } catch (err) {
    tbody.innerHTML = '<tr><td colspan="8">Error loading logs</td></tr>';
    console.error(err);
  }
}

// Load logs on page load
loadLogs();
</script>
</body>
</html>
